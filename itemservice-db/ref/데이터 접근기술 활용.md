# 데이터 접근 기술 활용

`ItemRepository`라는 인터페이스를 사용함으로써 `ItemService` 코드 수정이 없다는 장점을 볼 수 있었다.  
repository를 직접 사용한다면 구조가 단순해지고 구현이 쉬울 것이다.  

만약 `ItemRepository`를 사용하는 대신 직접 `Spring Data JPA`를 사용하면 복잡한 어뎁터를 제거해 코드 단순화가 가능하다.  

이 부분에서 트레이드 오프가 있다.
1. DI, OCP를 지키기 위해 어댑터 도입, 더 많은 코드 유지
2. 구조를 단순화, DI, OCP 포기하는 것(`ItemService`를 직접 수정)

어설픈 추상화는 독이 된다. **추상화도 비용이 든다.**  
추상화 비용을 넘어설때 추상화를 도입하는 것이 좋다고 생각한다. -> 현재 상황에 맞는 코드 설계를 하는 것이 좋다.  

## 데이터 접근 기술 조합

`JdbcTemplate`, `MyBatis`의 경우에는 기술이 단순하기 때문에 SQL에 익숙한 개발자라면 금방 적응할 수 있다.  
`JPA`, `QueryDSL` 같은 경우는 개발 생산성을 높이지만 학습 곡선이 높다.  

복잡한 쿼리를 사용해야하는데 해결이 안된다면, 또는 직접 SQL을 써야한다면  
`JdbcTemplate`, `MyBatis`을 사용하는 것이 좋다.  

### 트랜잭션 매니저
`JdbcTemplate`, `JPA` 두 기술을 같이 쓰면 트랜잭션  매니저가 달라진다.  
하지만 `JpaTransactionManager`는 `DataSourceTransactionManager`가 제공하는 기능도 대부분 제공하기 때문에 문제가 없다.  

### 함께 사용할 시 주의점
JPA는 변경사항을 즉시 데이터베이스에 반영하지 않는다.(영속성 컨텍스트)  
따라서 JdbcTemplate의 트랜잭션이 JPA의 변경사항을 읽지 못하는 경우가 생긴다.  
이러한 경우에는 JPA의 `flush()`를 사용할때 마지막에 꼭 호출해줘서 해결해야 한다.  