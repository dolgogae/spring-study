# 트랜잭션 전파

## 외부 트랜잭션이 수행중인데, 내부 트랜잭션이 추가 수행
클라이언트 -> 로직1(외부 트랜잭션) -> 로직2(내부 트랜잭션)

이 경우 내부 트랜잭션이 외부 트랜잭션에 참여하는 것이다. 마치 하나의 트랜잭션처럼 보인다.

### 물리 트랜잭션
실제로 데이터베이스에 적용되는 트랜잭션을 의미한다.  
실제 커넥션을 통해서 커밋, 롤백하는 단위이다.

### 논리 트랜잭션
논리 트랜잭션은 하나의 물리 트랜잭션으로 나뉜다.  
논리 트랜잭션은 `트랜잭션 매니져`를 통해서 사용되는 단위이다.  
트랜잭션중에 또 다른 트랜잭션을 시작하는 경우에 시작되는 개념이다.  

> **원칙**  
> 모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋된다.  
> 하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백된다.  

## 내부 트랜잭션은 커밋되는데, 외부 트랜잭션은 롤백
논리 트랜잭션이 하나라도 롤백되면 전체 물리 트랜잭션은 롤백된다.
따라서 내부는 커밋됐어도 롤백된다.

## 내부 트랜잭션은 롤백, 외부 트랜잭션은 커밋
원칙 중에서 하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백된다 => 따라서 외부 트랜잭션도 롤백

## 외부 트랜잭션과 내부 트랜잭션의 분리
`REQUIRES_NEW`옵션 사용시에는 트랜잭션마다 별도의 물리 트랜잭션을 사용하게 된다.  
따라서 각각의 트랜잭션이 서로에게 영향을 미치지 않는다.
